
init.sh script started
 Repository home is /home/virgolaema/dune/online-pointing-utils
 Parameters directory is /home/virgolaema/dune/online-pointing-utils/parameters
 WARNING: python environment not found, not activating.
init.sh finished

**************************
Selected options:
Run backtrack:		true
Run analyze_tps:	false
Run add backgrounds:	true
Run make clusters:	true
Run analyze:		false
Run generate images:	false
Run generate volumes:	true
Run analyze volumes:	true
Clean clusters (no backgrounds):	false
No compile:		false
Clean compile:		false
Override:		true
**************************

**************************
Sample selected: .
Global json settings file provided: json/es_valid_test.json
**************************
 Looking for json settings using command: /home/virgolaema/dune/online-pointing-utils/scripts/findSettings.sh -j json/es_valid_test.json
Global settings file found, full path is: /home/virgolaema/dune/online-pointing-utils/json/es_valid_test.json 

Using this for all steps, overriding individual jsons.
Compiling the code with the following command:
/home/virgolaema/dune/online-pointing-utils/scripts/compile.sh -p /home/virgolaema/dune/online-pointing-utils --no-compile false --clean-compile false
Starting script ./scripts/sequence.sh
Environment is already initialized, not running init.sh again.
If it is not loaded properly, run export INIT_DONE=false and rerun init.sh
 Got home path as argument
  Compiling the code, these steps need to be run from build/
-- Detected GCC version: 11.4.0
-- [32m[INFO]:[m Looking for ROOT install...
-- [32m[INFO]:[m [ROOT]: ROOT found.
-- [32m[INFO]:[m [ROOT]: ROOT cmake use file /usr/local/cmake/ROOTUseFile.cmake
-- [32m[INFO]:[m [ROOT]: ROOT include directory: /usr/local/include
-- [32m[INFO]:[m [ROOT]: ROOT C++ Flags:  -std=c++17 -pipe -fsigned-char -pthread
-- ROOT compiled with C++17
-- [32m[INFO]:[m nlohmann JSON header found: /usr/local/include/nlohmann/json.hpp
-- [32m[INFO]:[m Adding submodules to the project...
-- [32m[INFO]:[m Looking for simple-cpp-cmd-line-parser submodule...
-- [1;33m[WARN]:[m Checking submodule: simple-cpp-cmd-line-parser
-- [32m[INFO]:[m Git submodule simple-cpp-cmd-line-parser is present
-- [32m[INFO]:[m Looking for simple-cpp-logger submodule...
-- [1;33m[WARN]:[m Checking submodule: simple-cpp-logger
-- [32m[INFO]:[m Git submodule simple-cpp-logger is present
-- [32m[INFO]:[m Looking for cpp-generic-toolbox submodule...
-- [1;33m[WARN]:[m Checking submodule: cpp-generic-toolbox
-- [32m[INFO]:[m Git submodule cpp-generic-toolbox is present
-- [32m[INFO]:[m Configuring ana library...
-- [32m[INFO]:[m Creating plot_avg_times app...
-- [32m[INFO]:[m Creating make_clusters app...
-- [32m[INFO]:[m Creating backtrack_tpstream app...
-- [32m[INFO]:[m Creating analyze_clusters app...
-- [32m[INFO]:[m Creating analyze_tps app...
-- [32m[INFO]:[m Creating extract_calibration app...
-- [32m[INFO]:[m Creating display app...
-- [32m[INFO]:[m Creating add_backgrounds app...
-- [32m[INFO]:[m Creating extract_energy_cut_stats app...
-- [32m[INFO]:[m Creating split_by_apa app...
-- Configuring done
-- Generating done
-- Build files have been written to: /home/virgolaema/dune/online-pointing-utils/build
Consolidate compiler generated dependencies of target split_by_apa
Consolidate compiler generated dependencies of target globalLib
[  5%] Built target split_by_apa
[ 15%] Built target globalLib
Consolidate compiler generated dependencies of target backtrackingLibs
Consolidate compiler generated dependencies of target anaLib
[ 20%] Built target backtrackingLibs
[ 27%] Built target anaLib
Consolidate compiler generated dependencies of target objectsLibs
[ 37%] Built target objectsLibs
Consolidate compiler generated dependencies of target clustersLibs
[ 50%] Built target clustersLibs
Consolidate compiler generated dependencies of target planesMatchingLibs
Consolidate compiler generated dependencies of target make_clusters
Consolidate compiler generated dependencies of target backtrack_tpstream
Consolidate compiler generated dependencies of target analyze_tps
Consolidate compiler generated dependencies of target analyze_clusters
Consolidate compiler generated dependencies of target plot_avg_times
[ 55%] Built target analyze_clusters
[ 60%] Built target backtrack_tpstream
[ 65%] Built target planesMatchingLibs
[ 70%] Built target analyze_tps
[ 75%] Built target make_clusters
[ 80%] Built target plot_avg_times
Consolidate compiler generated dependencies of target extract_calibration
Consolidate compiler generated dependencies of target add_backgrounds
Consolidate compiler generated dependencies of target extract_energy_cut_stats
[ 85%] Built target extract_calibration
[ 90%] Built target add_backgrounds
Consolidate compiler generated dependencies of target display
[ 95%] Built target extract_energy_cut_stats
[100%] Built target display
  Compilation finished successfully!

Running backtrack step with command:
./scripts/backtrack.sh -j /home/virgolaema/dune/online-pointing-utils/json/es_valid_test.json --no-compile -f true -v false -d false
Environment is already initialized, not running init.sh again.
If it is not loaded properly, run export INIT_DONE=false and rerun init.sh
 Looking for json settings using command: /home/virgolaema/dune/online-pointing-utils/scripts/findSettings.sh -j /home/virgolaema/dune/online-pointing-utils/json/es_valid_test.json
Settings file found, full path is: /home/virgolaema/dune/online-pointing-utils/json/es_valid_test.json 

Compiling the code with the following command:
/home/virgolaema/dune/online-pointing-utils/scripts/compile.sh -p /home/virgolaema/dune/online-pointing-utils --no-compile true --clean-compile false
Starting script ./scripts/backtrack.sh
Environment is already initialized, not running init.sh again.
If it is not loaded properly, run export INIT_DONE=false and rerun init.sh
 Got home path as argument
  No compilation was requested. Stopping execution of this script.

Running: /home/virgolaema/dune/online-pointing-utils/build//src/app/backtrack_tpstream -j /home/virgolaema/dune/online-pointing-utils/json/es_valid_test.json --override
29/10/2025 19:26:38 [32m[backtrack_tpstream.cpp][0m: > backtrack app - extract TPs and attach truth, writing *_tps_bktr<N>.root files (N: backtracker_error_margin).

29/10/2025 19:26:38 [32m[backtrack_tpstream.cpp][0m: Usage: 
29/10/2025 19:26:38 [32m[backtrack_tpstream.cpp][0m: â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Main options â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
29/10/2025 19:26:38 [32m[backtrack_tpstream.cpp][0m: json {-j,--json}: JSON file containing the configuration (expected: 1 value)
29/10/2025 19:26:38 [32m[backtrack_tpstream.cpp][0m: outFolder {--output-folder}: Output folder path (default: data) (expected: 1 value)
29/10/2025 19:26:38 [32m[backtrack_tpstream.cpp][0m: inputFile {-i,--input-file}: Input file with list OR single ROOT file path (overrides JSON inputs) (expected: 1 value)
29/10/2025 19:26:38 [32m[backtrack_tpstream.cpp][0m: bktrMargin {--bktr-margin}: Override backtracker_error_margin (int) (expected: 1 value)
29/10/2025 19:26:38 [32m[backtrack_tpstream.cpp][0m: â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Triggers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
29/10/2025 19:26:38 [32m[backtrack_tpstream.cpp][0m: verboseMode {-v,--verbose}: Run in verbose mode (trigger)
29/10/2025 19:26:38 [32m[backtrack_tpstream.cpp][0m: debugMode {-d,--debug}: Run in debug mode (more detailed than verbose) (trigger)
29/10/2025 19:26:38 [32m[backtrack_tpstream.cpp][0m: overrideMode {-f,--override}: Force reprocessing even if output already exists (trigger)


29/10/2025 19:26:38 [32m[backtrack_tpstream.cpp][0m: Loading JSON config: /home/virgolaema/dune/online-pointing-utils/json/es_valid_test.json
29/10/2025 19:26:38 [32m[backtrack_tpstream.cpp][0m: Using backtracker_error_margin: 10
29/10/2025 19:26:38 [32m[utils.cpp][0m: [find_input_files] Called with pattern: tpstream
29/10/2025 19:26:38 [32m[backtrack_tpstream.cpp][0m: Number of valid files: 2
29/10/2025 19:26:38 [32m[backtrack_tpstream.cpp][0m: Max files: 2
29/10/2025 19:26:38 [32m[backtrack_tpstream.cpp][0m: Number of files to skip at start: 0
29/10/2025 19:26:38 [32m[backtrack_tpstream.cpp][0m: Output folder (pure signal TPs): /home/virgolaema/dune/online-pointing-utils/data/prod_es/
29/10/2025 19:26:38 [32m[backtrack_tpstream.cpp][0m: Effective time window (TDC ticks): 352 (conversion_tdc_to_tpc=32)
29/10/2025 19:26:38 [32m[backtrack_tpstream.cpp][0m: Channel tolerance (channels): 0
Processing files...  50% (  500 it/s)
[1F[1K29/10/2025 19:26:40 [33m[Backtracking.cpp][0m: TriggerPrimitive version is not 2, be sure to have converted time_peak to samples_to_peak
29/10/2025 19:26:40 [33m[Backtracking.cpp][0m: No SimIDEs found for event 224908
29/10/2025 19:26:40 [33m[Backtracking.cpp][0m: No SimIDEs found for event 224919
Processing files... 100% (    0 it/s)
29/10/2025 19:26:42 [33m[Backtracking.cpp][0m: No SimIDEs found for event 225317
29/10/2025 19:26:43 [33m[Backtracking.cpp][0m: No SimIDEs found for event 225329
29/10/2025 19:26:44 [32m[backtrack_tpstream.cpp][0m: 
29/10/2025 19:26:44 [32m[backtrack_tpstream.cpp][0m: List of output files (2):
29/10/2025 19:26:44 [32m[backtrack_tpstream.cpp][0m:  - /home/virgolaema/dune/online-pointing-utils/data/prod_es//prodmarley_nue_flat_es_dune10kt_1x2x2_20250927T182943Z_gen_004499_supernova_g4_detsim_ana_2025-10-21T_095334Z_tps.root
29/10/2025 19:26:44 [32m[backtrack_tpstream.cpp][0m:  - /home/virgolaema/dune/online-pointing-utils/data/prod_es//prodmarley_nue_flat_es_dune10kt_1x2x2_20250927T182944Z_gen_004507_supernova_g4_detsim_ana_2025-10-21T_095344Z_tps.root

Running add backgrounds step with command:
./scripts/add_backgrounds.sh -j /home/virgolaema/dune/online-pointing-utils/json/es_valid_test.json --no-compile -f true -v false -d false
Environment is already initialized, not running init.sh again.
If it is not loaded properly, run export INIT_DONE=false and rerun init.sh
 Looking for json settings using command: /home/virgolaema/dune/online-pointing-utils/scripts/findSettings.sh -j /home/virgolaema/dune/online-pointing-utils/json/es_valid_test.json
Settings file found, full path is: /home/virgolaema/dune/online-pointing-utils/json/es_valid_test.json 

Compiling the code with the following command:
/home/virgolaema/dune/online-pointing-utils/scripts/compile.sh -p /home/virgolaema/dune/online-pointing-utils --no-compile true --clean-compile
Starting script ./scripts/add_backgrounds.sh
Environment is already initialized, not running init.sh again.
If it is not loaded properly, run export INIT_DONE=false and rerun init.sh
 Got home path as argument
  No compilation was requested. Stopping execution of this script.

Running: /home/virgolaema/dune/online-pointing-utils/build//src/app/add_backgrounds -j /home/virgolaema/dune/online-pointing-utils/json/es_valid_test.json -f
29/10/2025 19:26:44 [32m[add_backgrounds.cpp][0m: > add_backgrounds app - Merge signal TPs with random background events, writing *_tps_bg.root files.

29/10/2025 19:26:44 [32m[add_backgrounds.cpp][0m: Usage: 
29/10/2025 19:26:44 [32m[add_backgrounds.cpp][0m: â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Main options â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
29/10/2025 19:26:44 [32m[add_backgrounds.cpp][0m: json {-j,--json}: JSON file containing the configuration (expected: 1 value)
29/10/2025 19:26:44 [32m[add_backgrounds.cpp][0m: skip_files {-s,--skip}: Number of files to skip at start (overrides JSON) (expected: N values)
29/10/2025 19:26:44 [32m[add_backgrounds.cpp][0m: max_files {-m,--max}: Maximum number of files to process (overrides JSON) (expected: N values)
29/10/2025 19:26:44 [32m[add_backgrounds.cpp][0m: verboseMode {-v,--verbose}: Run in verbose mode (trigger)
29/10/2025 19:26:44 [32m[add_backgrounds.cpp][0m: debugMode {-d,--debug}: Run in debug mode (more detailed than verbose) (trigger)
29/10/2025 19:26:44 [32m[add_backgrounds.cpp][0m: override {-f,--override}: Override existing output files (trigger)


29/10/2025 19:26:44 [32m[add_backgrounds.cpp][0m: Number of files to skip at start: 0
29/10/2025 19:26:44 [32m[add_backgrounds.cpp][0m: Configuration:
29/10/2025 19:26:44 [32m[add_backgrounds.cpp][0m:  - Signal type: es
29/10/2025 19:26:44 [32m[add_backgrounds.cpp][0m:  - Signal folder (pure signal TPs): /home/virgolaema/dune/online-pointing-utils/data/prod_es/
29/10/2025 19:26:44 [32m[add_backgrounds.cpp][0m:  - Background folder (pure bg TPs): /home/virgolaema/dune/online-pointing-utils/data/bkgs/
29/10/2025 19:26:44 [32m[add_backgrounds.cpp][0m:  - Output folder (merged TPs): /home/virgolaema/dune/online-pointing-utils/data/prod_es/bkgs/
29/10/2025 19:26:44 [32m[add_backgrounds.cpp][0m:  - Add backgrounds around vertex only: NO
29/10/2025 19:26:44 [32m[add_backgrounds.cpp][0m:  - Max files to process: 2
29/10/2025 19:26:44 [32m[utils.cpp][0m: [find_input_files] Called with pattern: sig
29/10/2025 19:26:44 [32m[add_backgrounds.cpp][0m: Found 2 signal files
29/10/2025 19:26:44 [32m[utils.cpp][0m: [find_input_files] Called with pattern: bg
29/10/2025 19:26:44 [32m[add_backgrounds.cpp][0m: Found 2 background files
Adding backgrounds...  50% (    5 it/s)
[1F[1KAdding backgrounds... 100% (    2 it/s)
29/10/2025 19:26:45 [32m[add_backgrounds.cpp][0m: 
29/10/2025 19:26:45 [32m[add_backgrounds.cpp][0m: 
29/10/2025 19:26:45 [32m[add_backgrounds.cpp][0m: Processed 2 files successfully.
29/10/2025 19:26:45 [32m[add_backgrounds.cpp][0m: Output files are in the same directories as input files with '_bkg' suffix.
29/10/2025 19:26:45 [32m[add_backgrounds.cpp][0m: 
29/10/2025 19:26:45 [32m[add_backgrounds.cpp][0m: Note: In the output files, background TPs have their original generator labels,
29/10/2025 19:26:45 [32m[add_backgrounds.cpp][0m:       allowing you to distinguish signal (MARLEY) from background (e.g., radiological).
29/10/2025 19:26:45 [32m[add_backgrounds.cpp][0m: 
29/10/2025 19:26:45 [32m[add_backgrounds.cpp][0m: Output files (2):
29/10/2025 19:26:45 [32m[add_backgrounds.cpp][0m:  - /home/virgolaema/dune/online-pointing-utils/data/prod_es/bkgs//prodmarley_nue_flat_es_dune10kt_1x2x2_20250927T182943Z_gen_004499_supernova_g4_detsim_ana_2025-10-21T_095334Z_bg_tps.root
29/10/2025 19:26:45 [32m[add_backgrounds.cpp][0m:  - /home/virgolaema/dune/online-pointing-utils/data/prod_es/bkgs//prodmarley_nue_flat_es_dune10kt_1x2x2_20250927T182944Z_gen_004507_supernova_g4_detsim_ana_2025-10-21T_095344Z_bg_tps.root

Running make clusters step with command:
./scripts/make_clusters.sh -j /home/virgolaema/dune/online-pointing-utils/json/es_valid_test.json --no-compile -f true -v false -d false
Environment is already initialized, not running init.sh again.
If it is not loaded properly, run export INIT_DONE=false and rerun init.sh
Starting script ./scripts/make_clusters.sh
Environment is already initialized, not running init.sh again.
If it is not loaded properly, run export INIT_DONE=false and rerun init.sh
 Got home path as argument
  No compilation was requested. Stopping execution of this script.

Running: /home/virgolaema/dune/online-pointing-utils/build//src/app/make_clusters -j /home/virgolaema/dune/online-pointing-utils/json/es_valid_test.json
29/10/2025 19:26:45 [32m[make_clusters.cpp][0m: > Cluster app - build clusters from *_tps.root files.

29/10/2025 19:26:45 [32m[make_clusters.cpp][0m: Usage: 
29/10/2025 19:26:45 [32m[make_clusters.cpp][0m: â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Main options â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
29/10/2025 19:26:45 [32m[make_clusters.cpp][0m: json {-j,--json}: JSON file containing the configuration (expected: 1 value)
29/10/2025 19:26:45 [32m[make_clusters.cpp][0m: inputFile {-i,--input-file}: Input file with list OR single ROOT file path (overrides JSON inputs) (expected: 1 value)
29/10/2025 19:26:45 [32m[make_clusters.cpp][0m: skip_files {-s,--skip}: Number of files to skip at start (overrides JSON) (expected: N values)
29/10/2025 19:26:45 [32m[make_clusters.cpp][0m: max_files {-m,--max}: Maximum number of files to process (overrides JSON) (expected: N values)
29/10/2025 19:26:45 [32m[make_clusters.cpp][0m: override {-f,--override}: Override existing output files (default: false) (trigger)
29/10/2025 19:26:45 [32m[make_clusters.cpp][0m: outFolder {--output-folder}: Output folder path (default: data) (expected: 1 value)
29/10/2025 19:26:45 [32m[make_clusters.cpp][0m: verboseMode {-v}: RunVerboseMode, bool (trigger)
29/10/2025 19:26:45 [32m[make_clusters.cpp][0m: debugMode {-d}: Run in debug mode (more detailed than verbose) (trigger)


29/10/2025 19:26:45 [32m[utils.cpp][0m: [find_input_files] Called with pattern: tps
29/10/2025 19:26:45 [32m[make_clusters.cpp][0m: Number of valid files (merged TPs): 2
29/10/2025 19:26:45 [32m[make_clusters.cpp][0m: Number of files to skip at start: 0
29/10/2025 19:26:45 [32m[make_clusters.cpp][0m: Settings from json file:
29/10/2025 19:26:45 [32m[make_clusters.cpp][0m:  - Base output folder: /home/virgolaema/dune/online-pointing-utils/data/prod_es/bkgs/
29/10/2025 19:26:45 [32m[make_clusters.cpp][0m:  - Full clusters path: /home/virgolaema/dune/online-pointing-utils/data/prod_es/bkgs//clusters_es_valid_test_bg_tick3_ch2_min2_tot3_e2p0
29/10/2025 19:26:45 [32m[make_clusters.cpp][0m:  - Tick limit: 3
29/10/2025 19:26:45 [32m[make_clusters.cpp][0m:  - Channel limit: 2
29/10/2025 19:26:45 [32m[make_clusters.cpp][0m:  - Minimum TPs to form a cluster: 2
29/10/2025 19:26:45 [32m[make_clusters.cpp][0m:  - Energy cut: 2
29/10/2025 19:26:45 [32m[make_clusters.cpp][0m:     - ADC integral cut (induction): 1800
29/10/2025 19:26:45 [32m[make_clusters.cpp][0m:     - ADC integral cut (collection): 7200
29/10/2025 19:26:45 [32m[make_clusters.cpp][0m:  - ToT cut: 3
29/10/2025 19:26:45 [32m[make_clusters.cpp][0m:  - Max files to process: 2
29/10/2025 19:26:45 [32m[make_clusters.cpp][0m: Output file already exists (use -f to override): /home/virgolaema/dune/online-pointing-utils/data/prod_es/bkgs//clusters_es_valid_test_bg_tick3_ch2_min2_tot3_e2p0/prodmarley_nue_flat_es_dune10kt_1x2x2_20250927T182943Z_gen_004499_supernova_g4_detsim_ana_2025-10-21T_095334Z_bg_clusters.root
29/10/2025 19:26:45 [32m[make_clusters.cpp][0m: Output file already exists (use -f to override): /home/virgolaema/dune/online-pointing-utils/data/prod_es/bkgs//clusters_es_valid_test_bg_tick3_ch2_min2_tot3_e2p0/prodmarley_nue_flat_es_dune10kt_1x2x2_20250927T182944Z_gen_004507_supernova_g4_detsim_ana_2025-10-21T_095344Z_bg_clusters.root
29/10/2025 19:26:45 [32m[make_clusters.cpp][0m: 
29/10/2025 19:26:45 [32m[make_clusters.cpp][0m: Clustering complete! Generated 0 output file(s):

Running generate volumes step with command:
/home/virgolaema/dune/online-pointing-utils/scripts/create_volumes.sh -j /home/virgolaema/dune/online-pointing-utils/json/es_valid_test.json
Environment is already initialized, not running init.sh again.
If it is not loaded properly, run export INIT_DONE=false and rerun init.sh

==================================================
Volume Image Creation Pipeline
==================================================
JSON config: /home/virgolaema/dune/online-pointing-utils/json/es_valid_test.json
==================================================

============================================================
Volume Image Creation for Channel Tagging
============================================================
Clusters folder: /home/virgolaema/dune/online-pointing-utils/data/prod_es/bkgs/
Output folder: /home/virgolaema/dune/online-pointing-utils/data/prod_es/volumes_planeX_bg/
Plane: X
Volume size: 100.0 cm x 100.0 cm
Processing at most 2 files
============================================================
No cluster files found in /home/virgolaema/dune/online-pointing-utils/data/prod_es/bkgs/
Error: Generate volumes step failed.
